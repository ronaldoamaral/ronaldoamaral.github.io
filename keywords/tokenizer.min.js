(function(d){var c="tokenizer";var b=function(g,e){var p,v,o,q,r=d({}),h=d.extend({xContent:"&times;",namespace:"tknz",label:"Tags:",placeholder:"",separators:[","," ","."],callback:null,source:null,allowUnknownTags:true,numToSuggest:5,onclick:null},e);var t,z,f,k,l,y,w,n,x,j,m,u,s,i;t=function(){p=g;z();f()};z=function(){var A=h.namespace;v=d('<div class="'+A+'-list"></div>');if(h.placeholder){p.attr("placeholder",h.placeholder)}q=d('<div class="'+A+'-suggest"><ul></ul></div>');o=p.addClass(A+"-input").wrap('<span class="'+A+'-input-wrapper"></span>').parent().wrap('<div class="'+A+'-wrapper"></div>').parent().prepend(v).prepend('<span class="'+A+'-wrapper-label">'+h.label+"</span>").find("."+A+"-input-wrapper").append(q).end()};f=function(){var A=h.namespace;o.on("focus","input",function(){o.addClass(A+"-focus")}).on("blur","input",function(){o.removeClass(A+"-focus");r.delay(200).queue().push(function(){s(p.val());d.dequeue(this)})}).on("keydown","input",function(D){D=D||window.event;D.which=D.which||D.keyCode||D.charCode;if(D.which===8&&!p.val()){l();j();return}var C=A+"-sel",B=q.find("."+C);if(D.which===38){D.preventDefault();if(B.length){B.removeClass(C).prev("li").add(B.siblings().last()).eq(0).addClass(C)}else{q.find("li").last().addClass(C)}}else{if(D.which===40){D.preventDefault();if(B.length){B.removeClass(C).next("li").addClass(C)}else{q.find("li").first().addClass(C)}}}}).on("keypress","input",function(B){if(h.separators.indexOf(String.fromCharCode(B.which))>-1||B.which===13){B.preventDefault();s(p.val())}}).on("keyup","input",function(B){B=B||window.event;B.which=B.which||B.keyCode||B.charCode;if(B.which===38||B.which===40){return}if(d.isArray(h.source)){m(h.source)}else{if(h.source){h.source(p.val(),m)}}}).on("click",function(){p.focus()}).on("click","."+A+"-token-x",function(B){B.stopPropagation();d(this).closest("."+A+"-token").remove();j()}).on("click","."+A+"-suggest-li",function(){d.queue(r,[]);p.val("");k(d(this).text(),d(this).attr("data-uri"));m([]);j()}).on("click","."+A+"-token",function(B){if(h.onclick){B.stopPropagation();h.onclick(d(this))}})};s=function(B){var A=u();if(B&&(h.allowUnknownTags||A)){k(A||B);p.val("");j()}m([],"")};k=function(D,C){var B=h.namespace,E=B+"-token",A='<div class="'+E+'" data-token="'+D+'" data-uri="'+C+'"><span class="'+E+'-label">'+D.trim()+'</span><span class="'+E+'-x">'+h.xContent+"</span></div>";v.append(A);return p};l=function(){return v.children().last().detach().data("token")||null};y=function(A){var B=v.children().filter(function(){return d(this).data("token")==A}).detach();return B.length>0?(B.length==1?B.data("token"):B.length):null};n=function(){v.empty();return p};w=function(){var A,C=[],B=v.children();for(A=0;A<B.length;A++){C.push(B.eq(A).data("token").toString())}return C};x=function(){o.after(p).remove();if(h.placeholder){p.attr("placeholder","")}return p.removeClass(h.namespace+"-input")};j=function(){(h.callback||d.noop)(p);return p};m=function(H,C,A){A=A===undefined?p.val():A;var D,I=h.namespace,F=new RegExp(i(A),"i"),E=new RegExp("^"+i(A)+"$","i"),B=h.numToSuggest||1000,G=[];for(D=0;A&&D<H.length&&G.length<B;D++){if(!H[D].match(F)){continue}G.push('<li class="'+I+"-suggest-li"+(H[D].match(E)?" "+I+"-sel":"")+'" data-uri="'+C[D]+'">'+H[D]+"</li>")}q.children("ul").html(G.join("")).end()[G.length?"addClass":"removeClass"]("."+I+"-vis")};u=function(){return q.find("."+h.namespace+"-sel").eq(0).text()};i=function(A){return A.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")};t(g);return{push:k,pop:l,remove:y,empty:n,get:w,destroy:x,callback:j}};var a={init:function(e){if(this[0].nodeName!=="INPUT"){d.error('Tokenizer requires an <input type="text"> tag.');return this}return this.data(c,b(this,e))},push:function(e){return this.data(c).push(e)},pop:function(){return this.data(c).pop()},remove:function(e){return this.data(c).remove(e)},empty:function(){return this.data(c).empty()},get:function(){return this.data(c).get()},destroy:function(){return this.data(c).destroy()},callback:function(){return this.data(c).callback()}};d.fn[c]=function(e){if(a[e]){if(!this.data(c)){d.error('Cannot call "'+e+'" - Tokenizer not initialized.')}return a[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||!e){return a.init.apply(this,arguments)}else{d.error("Unknown tokenizer method "+e+".")}}}}(jQuery));